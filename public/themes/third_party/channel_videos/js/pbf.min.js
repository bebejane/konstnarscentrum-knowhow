!function(e,i){"use strict";function t(e){return i(e.target).closest(".CVTable").find(".SVWrapperTR").toggle(),!1}function o(e){return 13==e.which?(i(e.target).closest(".CVField").find(".searchbutton").click(),!1):void 0}function d(){var e;w.each(function(t,o){i(o).find(".CVItem").each(function(t,o){i(o).find("input, textarea, select").each(function(){e=i(this).attr("name").replace(/\[videos\]\[.*?\]/,"[videos]["+(t+1)+"]"),i(this).attr("name",e)})}),i(o).find(".CVItem").removeClass("odd"),i(o).find(".CVItem:odd").addClass("odd")})}function s(e){var t=i(e.target).data("id");t&&i.get(V.ACT_URL,{video_id:t,ajax_method:"delete_video"},function(){}),i(e.target).closest(".CVItem").fadeOut("slow",function(){i(this).remove(),d()})}function a(e){var i=jQuery(e.target).closest(".CVField");return i.find(".VideosResults .inner").empty(),!1}function r(e){e.preventDefault();var t={},o=i(e.target).closest(".CVField"),d=b["field_"+o.data("field_id")].services;o.find(".SVWrapper .cvsearch").find("input[type=text], input[type=hidden]").each(function(){t[i(this).attr("rel")]=jQuery(this).val()});for(var s=0;s<d.length;s++)o.find(".VideosResults .results-"+d[s]).show().find(".LoadingVideos").show().siblings(".inner").empty(),"youtube"==d[s]?c(t,o):f(t,o)}function n(e,i,t){var o="";0===i.length&&(o+="<p>No Results Found...</p>");for(var d=0;d<i.length;d++)o+='<div class="video" rel="'+e+"|"+i[d].id+'" id="'+e+"__"+i[d].id+'">',o+='<img src="'+i[d].img_url+'" width="100px" height="75px">',o+="<small>"+i[d].title+"</small>",o+="<span>",o+='<a href="'+i[d].vid_url+'" class="play">&nbsp;</a>',o+='<a href="#" class="add">&nbsp;</a>',o+="</span>",o+="</div>";o+='<br clear="all"></div>',t.find(".VideosResults .results-"+e).find(".LoadingVideos").hide().siblings(".inner").show().html(o),t.find(".VideosResults .video .play").colorbox({iframe:!0,width:450,height:375})}function l(e){var t=prompt("Video URL?","");if(null===t)return!1;var o=i(e.target).closest("div.CVField"),d=b["field_"+o.data("field_id")].services;o.find(".SVWrapperTR").show();for(var s=0;s<d.length;s++)o.find(".VideosResults .results-"+d[s]).show().find(".LoadingVideos").show().siblings(".inner").empty(),"youtube"==d[s]?v(t,o):m(t,o);return!1}function u(e,t){var o=b["field_"+t],s=i("#ChannelVideos"+t),a="";s.find("#"+e.service+"__"+e.service_video_id).slideUp();var r=new Date;r.setTime(1e3*e.video_date),"table"==o.layout?(a+='<tr class="CVItem">',a+='<td><a href="'+e.video_url+'" class="PlayVideo"><img src="'+e.video_img_url+'" width="100px" height="75px"></a></td>',a+="<td>"+e.video_title+"</td>",a+="<td>"+e.video_author+"</td>",a+="<td>"+(e.video_duration/60).toFixed(2)+" min</td>",a+="<td>"+e.video_views+"</td>",a+="<td>"+r.toDateString()+"</td>",a+="<td>",a+='<a href="javascript:void(0)" class="MoveVideo">&nbsp;</a>',a+='<a href="javascript:void(0)" class="DelVideo" data-id="'+e.video_id+'">&nbsp;</a>',a+=e.video_id>0?'<input name="'+o.field_name+'[videos][0][video_id]" type="hidden" value="'+e.video_id+'">':'<textarea name="'+o.field_name+'[videos][0][data]" style="display:none">'+JSON.stringify(e)+"</textarea>",a+="</td>",a+="</tr>"):(a+='<div class="CVItem VideoTile">',a+='<a href="'+e.video_url+'" class="PlayVideo"><img src="'+e.video_img_url+'" width="100px" height="75px"></a>',a+="<small>"+e.video_title+"</small>",a+="<span>",a+='<a href="javascript:void(0)" class="MoveVideo">&nbsp;</a>',a+='<a href="javascript:void(0)" class="DelVideo" data-id="'+e.video_id+'">&nbsp;</a>',a+=e.video_id>0?'<input name="'+o.field_name+'[videos][0][video_id]" type="hidden" value="'+e.video_id+'">':'<textarea name="'+o.field_name+'[videos][0][data]" style="display:none">'+JSON.stringify(e)+"</textarea>",a+="</span>",a+="</div>"),s.find(".AssignedVideos .NoVideos").hide(),s.find(".AssignedVideos").append(a),d(),s.find(".AssignedVideos .CVItem .PlayVideo").colorbox({iframe:!0,width:450,height:375})}function p(e){var i=jQuery(e.target).closest("div.video"),t=jQuery(e.target).closest("div.CVField"),o=t.data("field_id"),d=i.attr("rel").split("|")[1],s=i.attr("rel").split("|")[0];return jQuery(e.target).addClass("loading"),"youtube"==s?(h(d,o,u),!1):(_(d,o,u),!1)}function c(e,t){e.author&&(e.keywords+=" "+e.author),i.ajax({crossDomain:!0,dataType:"json",type:"GET",url:"https://www.googleapis.com/youtube/v3/search",data:{q:e.keywords,maxResults:e.limit,type:"video",part:"snippet",key:C},success:function(e){for(var i=[],o=0;o<e.items.length;o++){var d=e.items[o],s=d.id.videoId;i.push({id:s,title:d.snippet.title,img_url:"https://i.ytimg.com/vi/"+s+"/sddefault.jpg",vid_url:"https://www.youtube.com/embed/"+s})}n("youtube",i,t)}})}function v(e,t){var o,d=t.find(".VideosResults .results-youtube").show(),s=d.find(".inner"),a=d.find(".LoadingVideos"),r=null;return-1===e.indexOf("youtube")&&-1===e.indexOf("youtu.be")?(a.hide(),void s.html("<p>Not a valid Youtube URL</p>")):(e.indexOf("youtube.com/watch")>0?(o=g(e),r=y(o.query,"v")):e.indexOf("youtu.be")>0?(o=e.split("/"),r=o[o.length-1]):e.indexOf("youtube.com/embed")>0&&(o=e.split("/"),r=o[o.length-1]),null===r?(a.hide(),void s.html("<p>Could not parse Youtube ID from that URL</p>")):void i.ajax({crossDomain:!0,dataType:"json",type:"GET",url:"https://www.googleapis.com/youtube/v3/videos",data:{id:r,part:"snippet",key:C},success:function(e){a.hide(),("undefined"==typeof e.pageInfo||1!=typeof e.pageInfo.totalResults)&&s.html("<p>Youtube could not find the video. (ID: "+r+")</p>");var i=e.items[0],o=i.id;n("youtube",[{id:o,title:i.snippet.title,img_url:"https://i.ytimg.com/vi/"+o+"/sddefault.jpg",vid_url:"https://www.youtube.com/embed/"+o}],t)}}))}function h(e,t,o){i.ajax({crossDomain:!0,dataType:"json",type:"GET",url:"https://www.googleapis.com/youtube/v3/videos",data:{id:e,part:"snippet,statistics,contentDetails",key:C},success:function(i){var d=e,s={},a=i.items[0];s.service="youtube",s.service_video_id=d,s.video_id=0,s.video_url="http://www.youtube.com/embed/"+d,s.video_img_url="http://i.ytimg.com/vi/"+d+"/sddefault.jpg",s.video_title=a.snippet.title,s.video_desc=a.snippet.description,s.video_username=a.snippet.channelTitle,s.video_author=a.snippet.channelTitle,s.video_author_id=0,s.video_duration=nezasa.iso8601.Period.parseToTotalSeconds(a.contentDetails.duration),s.video_date=new Date(a.publishedAt).getTime()/1e3,s.video_views=0,"undefined"!=typeof a.statistics&&"undefined"!=typeof a.statistics.viewCount&&(s.video_views=a.statistics.viewCount),o(s,t)}})}function f(e,t){var o=t.find(".VideosResults .results-vimeo").show(),d=o.find(".inner"),s=o.find(".LoadingVideos");i.ajax({url:"https://api.vimeo.com/videos?query="+e.keywords+"&per_page="+e.limit+(e.author?"&user_id="+e.author:""),headers:{Authorization:"Bearer "+V.VIMEO_ACCESS_TOKEN},success:function(e){if("undefined"==typeof e.data)return s.hide(),void d.html("<p>The vimeo request failed!</p>");if(0===e.data.length)return s.hide(),void d.html("<p>No results found..</p>");for(var i,o=[],a=0;a<e.data.length;a++){i=e.data[a];for(var r,l,u=i.pictures.sizes.length-1;u>=0;u--)if(r=i.pictures.sizes[u],100===r.width){l=r.link;break}var p=i.uri.match(/(\d+)$/)[0];o.push({id:p,title:i.name,img_url:l,vid_url:"https://player.vimeo.com/video/"+p+"?title=0&byline=0&portrait=0"})}n("vimeo",o,t)}})}function m(e,t){var o,d=t.find(".VideosResults .results-vimeo").show(),s=d.find(".inner"),a=d.find(".LoadingVideos"),r=null;return-1===e.indexOf("vimeo")?(a.hide(),void s.html("<p>Not a valid Vimeo URL</p>")):(e.indexOf("vimeo.com/")>0&&(o=e.split("/"),r=o[o.length-1]),null===r?(a.hide(),void s.html("<p>Could not parse Vimeo ID from that URL</p>")):void i.ajax({url:"https://api.vimeo.com/videos/"+r,headers:{Authorization:"Bearer "+V.VIMEO_ACCESS_TOKEN},success:function(e){if("undefined"==typeof e.name)return a.hide(),void s.html("<p>The vimeo request failed!</p>");for(var i,o,d=e.pictures.sizes.length-1;d>=0;d--)if(i=e.pictures.sizes[d],100===i.width){o=i.link;break}var l={id:r,title:e.name,img_url:o,vid_url:"https://player.vimeo.com/video/"+r+"?title=0&byline=0&portrait=0"};n("vimeo",[l],t)}}))}function _(e,t,o){i.ajax({url:"https://api.vimeo.com/videos/"+e,headers:{Authorization:"Bearer "+V.VIMEO_ACCESS_TOKEN},success:function(i){if("undefined"==typeof i.name)return loading.hide(),void inner.html("<p>The vimeo request failed!</p>");for(var d,s,a=i.pictures.sizes.length-1;a>=0;a--)if(d=i.pictures.sizes[a],100===d.width){s=d.link;break}var r={service:"vimeo",service_video_id:e,video_id:0,video_url:"https://player.vimeo.com/video/"+e+"?title=0&byline=0&portrait=0",video_img_url:s,video_title:i.name,video_desc:i.description,video_username:i.user.name,video_author:i.user.name,video_author_id:0,video_duration:i.duration,video_views:i.stats.plays,video_date:new Date(i.created_time.replace(" ","T")+"-00:00").getTime()/1e3};o(r,t)}})}function g(e,i){for(var t=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],o={},d=o["phpjs.parse_url.mode"]&&o["phpjs.parse_url.mode"].local_value||"php",s={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},a=s[d].exec(e),r={},n=14;n--;)a[n]&&(r[t[n]]=a[n]);if(i)return r[i.replace("PHP_URL_","").toLowerCase()];if("php"!==d){var l=o["phpjs.parse_url.queryKey"]&&o["phpjs.parse_url.queryKey"].local_value||"queryKey";s=/(?:^|&)([^&=]*)=?([^&]*)/g,r[l]={},r[t[12]].replace(s,function(e,i,t){i&&(r[l][i]=t)})}return delete r.source,r}function y(e,i){for(var t=e,o=t.split("&"),d=0;d<o.length;d++){var s=o[d].split("=");if(decodeURIComponent(s[0])==i)return decodeURIComponent(s[1])}return null}var w,V=e.ChannelVideos=e.ChannelVideos||{},b={},C="AIzaSyD-ew6Tm9wIJIoMCMZuReb3xvs0ccNHvl4";V.Init=function(){w=i(".CVField"),w.each(function(e,t){t=i(t),b["field_"+t.data("field_id")]=JSON.parse(t.find(".jsondata").html())}),w.find(".SearchVideos").click(t),w.find(".SearchVideos input[type=text]").keypress(o),w.find(".SVWrapper .Button").click(r),w.find("   .SubmitVideoUrl").click(l),w.delegate(".VideosResults .video .add","click",p),w.delegate(".DelVideo","click",s),w.delegate(".ClearVideoSearch","click",a),w.find(".AssignedVideos").sortable({cursor:"move",opacity:.6,handle:".MoveVideo",update:d,helper:function(e,t){return t.children().each(function(){i(this).width(i(this).width())}),t},forcePlaceholderSize:!0,start:function(e,i){i.placeholder.html('<td colspan="20"></td>')},placeholder:"cvideo-reorder-state-highlight"}),w.find(".AssignedVideos .CVItem .PlayVideo").colorbox({iframe:!0,width:450,height:375})}}(window,jQuery),function(e,i){function t(e,i){var t,o=i?i:!1,d=[2,3,4,5,7,8,9],s=[0,0,0,0,0,0,0],a=[0,12,4,7,24,60,60];if(e=e.toUpperCase(),!e)return s;if("string"!=typeof e)throw new Error("Invalid iso8601 period string '"+e+"'");if(!(t=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(e)))throw new Error("String '"+e+"' is not a valid ISO8601 period.");for(var r=0;r<d.length;r++){var n=d[r];s[r]=t[n]?+t[n].replace(/[A-Za-z]+/g,""):0}if(o)for(var r=s.length-1;r>0;r--)s[r]>=a[r]&&(s[r-1]=s[r-1]+Math.floor(s[r]/a[r]),s[r]=s[r]%a[r]);return s}e.iso8601||(e.iso8601={}),e.iso8601.Period||(e.iso8601.Period={}),e.iso8601.version="0.2",e.iso8601.Period.parse=function(e,i){return t(e,i)},e.iso8601.Period.parseToTotalSeconds=function(e){for(var i=[31104e3,2592e3,604800,86400,3600,60,1],o=t(e),d=0,s=0;s<o.length;s++)d+=o[s]*i[s];return d},e.iso8601.Period.isValid=function(e){try{return t(e),!0}catch(i){return!1}},e.iso8601.Period.parseToString=function(e,i,o,d){var s=["","","","","","",""],a=t(e,d);i||(i=["year","month","week","day","hour","minute","second"]),o||(o=["years","months","weeks","days","hours","minutes","seconds"]);for(var r=0;r<a.length;r++)a[r]>0&&(1==a[r]?s[r]=a[r]+" "+i[r]:s[r]=a[r]+" "+o[r]);return s.join(" ").trim().replace(/[ ]{2,}/g," ")}}(window.nezasa=window.nezasa||{}),$(document).ready(function(){ChannelVideos.Init()});